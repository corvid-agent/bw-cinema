import{$ as m,A as P,F as h,J as C,La as N,N as L,O as c,R as D,T as I,Z as S,_ as u,ba as V,ca as M,da as k,ia as a,ja as s,ka as x,la as w,lb as A,ma as H,na as E,oa as p,pa as l,ua as T,v as _,wa as g,x as v,xa as O,y as f,ya as B,z as y,za as R}from"./chunk-TOYJLBVG.js";var Y=(o,t)=>t.id;function F(o,t){o&1&&(y(),a(0,"svg",10),x(1,"rect",12),s())}function $(o,t){o&1&&(y(),a(0,"svg",11),x(1,"path",13)(2,"path",14)(3,"line",15)(4,"line",16),s())}function j(o,t){if(o&1){let e=w();a(0,"button",9),p("click",function(){v(e);let r=l();return f(r.toggleVoice())}),u(1,F,2,0,":svg:svg",10)(2,$,5,0,":svg:svg",11),s()}if(o&2){let e=l();T("search__mic--recording",e.isListening()),S("aria-label",e.isListening()?"Stop voice search":"Voice search"),c(),m(e.isListening()?1:2)}}function G(o,t){if(o&1){let e=w();a(0,"button",21),p("mousedown",function(){let r=v(e).$implicit,n=l(2);return f(n.selectHistory(r))}),y(),a(1,"svg",22),x(2,"circle",23)(3,"polyline",24),s(),g(4),s()}if(o&2){let e=t.$implicit;c(4),B(" ",e," ")}}function U(o,t){if(o&1){let e=w();a(0,"div",7)(1,"div",17)(2,"span",18),g(3,"Recent Searches"),s(),a(4,"button",19),p("mousedown",function(){v(e);let r=l();return f(r.clearHistory())}),g(5,"Clear"),s()(),M(6,G,5,1,"button",20,V),s()}if(o&2){let e=l();c(6),k(e.searchHistory())}}function J(o,t){if(o&1&&g(0),o&2){let e=l().$implicit;B(" \xB7 ",e.directors[0])}}function X(o,t){if(o&1){let e=w();a(0,"li",27),p("mousedown",function(){let r=v(e).$implicit,n=l(2);return f(n.selectSuggestion(r))}),a(1,"span",28),g(2),s(),a(3,"span",29),g(4),u(5,J,1,1),s()()}if(o&2){let e=t.$implicit,i=t.$index,r=l(2);T("search__suggestion--active",i===r.activeIndex()),H("id","suggestion-"+i),S("aria-selected",i===r.activeIndex()),c(2),O(e.title),c(2),O(e.year),c(),m(e.directors.length>0?5:-1)}}function Q(o,t){if(o&1&&(a(0,"li",26),g(1),s()),o&2){let e=l(2);c(),R(" Showing ",e.suggestions().length," of ",e.totalMatches()," matches ")}}function W(o,t){if(o&1&&(a(0,"ul",8),M(1,X,6,7,"li",25,Y),u(3,Q,2,2,"li",26),s()),o&2){let e=l();c(),k(e.suggestions()),c(2),m(e.totalMatches()>e.suggestions().length?3:-1)}}var K=class o{searched=N();query=h("");suggestions=h([]);totalMatches=h(0);showSuggestions=h(!1);showHistory=h(!1);activeIndex=h(-1);isListening=h(!1);searchHistory=h(this.loadHistory());speechSupported=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window);static HISTORY_KEY="bw-cinema-search-history";static MAX_HISTORY=10;catalog=_(A);elRef=_(C);debounceTimer=null;recognition=null;onDocClick(t){this.elRef.nativeElement.contains(t.target)||(this.showSuggestions.set(!1),this.showHistory.set(!1))}ngOnDestroy(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.stopVoice()}onInput(t){let e=t.target.value;this.query.set(e),this.activeIndex.set(-1),this.showHistory.set(!1),this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.searched.emit(e),this.updateSuggestions(e),this.addToHistory(e)},300)}onKeydown(t){let e=this.suggestions();if(!(!this.showSuggestions()||e.length===0))switch(t.key){case"ArrowDown":t.preventDefault(),this.activeIndex.update(i=>(i+1)%e.length);break;case"ArrowUp":t.preventDefault(),this.activeIndex.update(i=>(i-1+e.length)%e.length);break;case"Enter":this.activeIndex()>=0&&(t.preventDefault(),this.selectSuggestion(e[this.activeIndex()]));break;case"Escape":this.showSuggestions.set(!1);break}}onFocus(){this.suggestions().length>0?this.showSuggestions.set(!0):this.query().length===0&&this.showHistory.set(!0)}selectSuggestion(t){this.showSuggestions.set(!1),this.showHistory.set(!1),this.query.set(t.title),this.addToHistory(t.title),this.searched.emit(t.title)}selectHistory(t){this.showHistory.set(!1),this.query.set(t),this.searched.emit(t),this.updateSuggestions(t)}clearHistory(){this.searchHistory.set([]),this.showHistory.set(!1);try{localStorage.removeItem(o.HISTORY_KEY)}catch{}}addToHistory(t){let e=t.trim();if(e.length<2)return;let i=this.searchHistory().filter(n=>n!==e),r=[e,...i].slice(0,o.MAX_HISTORY);this.searchHistory.set(r);try{localStorage.setItem(o.HISTORY_KEY,JSON.stringify(r))}catch{}}loadHistory(){try{let t=localStorage.getItem("bw-cinema-search-history");return t?JSON.parse(t):[]}catch{return[]}}toggleVoice(){this.isListening()?this.stopVoice():this.startVoice()}startVoice(){let t=window.SpeechRecognition??window.webkitSpeechRecognition;t&&(this.recognition=new t,this.recognition.lang="en-US",this.recognition.interimResults=!1,this.recognition.maxAlternatives=1,this.recognition.onresult=e=>{let i=e.results[0][0].transcript;this.query.set(i),this.searched.emit(i),this.updateSuggestions(i),this.isListening.set(!1)},this.recognition.onerror=()=>{this.isListening.set(!1)},this.recognition.onend=()=>{this.isListening.set(!1)},this.recognition.start(),this.isListening.set(!0))}stopVoice(){this.recognition&&(this.recognition.abort(),this.recognition=null),this.isListening.set(!1)}updateSuggestions(t){if(t.length<2){this.suggestions.set([]),this.totalMatches.set(0),this.showSuggestions.set(!1);return}let e=t.toLowerCase(),i=this.catalog.movies().filter(n=>n.title.toLowerCase().includes(e)||n.directors.some(d=>d.toLowerCase().includes(e)));this.totalMatches.set(i.length);let r=i.slice(0,8);this.suggestions.set(r),this.showSuggestions.set(r.length>0)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-search-bar"]],hostBindings:function(e,i){e&1&&E("click",function(n){return i.onDocClick(n)},L)},outputs:{searched:"searched"},decls:10,vars:5,consts:[["role","combobox","aria-expanded","false","aria-haspopup","listbox",1,"search"],["for","search-input",1,"sr-only"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","aria-hidden","true",1,"search__icon"],["cx","11","cy","11","r","8"],["d","m21 21-4.35-4.35"],["id","search-input","type","search","placeholder","Search by title, director, or year...","aria-label","Search films","aria-autocomplete","list","autocomplete","off",1,"search__input",3,"input","focus","keydown","value"],["type","button",1,"search__mic",3,"search__mic--recording"],[1,"search__history"],["role","listbox","id","search-suggestions",1,"search__suggestions"],["type","button",1,"search__mic",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x","6","y","6","width","12","height","12","rx","2"],["d","M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"],["d","M19 10v2a7 7 0 0 1-14 0v-2"],["x1","12","y1","19","x2","12","y2","23"],["x1","8","y1","23","x2","16","y2","23"],[1,"search__history-header"],[1,"search__history-label"],["type","button",1,"search__history-clear",3,"mousedown"],["type","button",1,"search__history-item"],["type","button",1,"search__history-item",3,"mousedown"],["width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","12","cy","12","r","10"],["points","12 6 12 12 16 14"],["role","option",1,"search__suggestion",3,"id","search__suggestion--active"],["role","presentation",1,"search__match-count"],["role","option",1,"search__suggestion",3,"mousedown","id"],[1,"search__suggestion-title"],[1,"search__suggestion-meta"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"label",1),g(2,"Search films"),s(),y(),a(3,"svg",2),x(4,"circle",3)(5,"path",4),s(),P(),a(6,"input",5),p("input",function(n){return i.onInput(n)})("focus",function(){return i.onFocus()})("keydown",function(n){return i.onKeydown(n)}),s(),u(7,j,3,4,"button",6),u(8,U,8,0,"div",7),u(9,W,4,1,"ul",8),s()),e&2&&(c(6),H("value",i.query()),S("aria-activedescendant",i.activeIndex()>=0?"suggestion-"+i.activeIndex():null),c(),m(i.speechSupported?7:-1),c(),m(!i.showSuggestions()&&i.showHistory()&&i.searchHistory().length>0?8:-1),c(),m(i.showSuggestions()&&i.suggestions().length>0?9:-1))},styles:[".search[_ngcontent-%COMP%]{position:relative;width:100%}.search__icon[_ngcontent-%COMP%]{position:absolute;left:14px;top:50%;transform:translateY(-50%);width:18px;height:18px;color:var(--text-tertiary);pointer-events:none;z-index:1}.search__input[_ngcontent-%COMP%]{width:100%;font-size:1rem;padding:var(--space-md) 52px var(--space-md) 42px;background-color:var(--bg-surface);color:var(--text-primary);border:1px solid var(--border);border-radius:var(--radius-lg)}.search__input[_ngcontent-%COMP%]:focus{border-color:var(--accent-gold);background-color:var(--bg-input)}.search__mic[_ngcontent-%COMP%]{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-tertiary);cursor:pointer;padding:6px;min-width:36px;min-height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:color .2s,background-color .2s}.search__mic[_ngcontent-%COMP%]:hover{color:var(--accent-gold);background-color:var(--accent-gold-dim)}.search__mic--recording[_ngcontent-%COMP%]{color:#e53e3e;animation:_ngcontent-%COMP%_pulse-mic 1.2s infinite}@keyframes _ngcontent-%COMP%_pulse-mic{0%,to{opacity:1}50%{opacity:.5}}.search__suggestions[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin:4px 0 0;padding:var(--space-xs) 0;list-style:none;background-color:var(--bg-surface);border:1px solid var(--border-bright);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:50;max-height:320px;overflow-y:auto}.search__suggestion[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:10px var(--space-md);cursor:pointer;transition:background-color .1s}.search__suggestion[_ngcontent-%COMP%]:hover, .search__suggestion--active[_ngcontent-%COMP%]{background-color:var(--bg-hover)}.search__suggestion--active[_ngcontent-%COMP%]{outline:2px solid var(--accent-gold);outline-offset:-2px}.search__suggestion-title[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary);font-size:.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-right:var(--space-sm)}.search__suggestion-meta[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-tertiary);white-space:nowrap;flex-shrink:0}.search__match-count[_ngcontent-%COMP%]{padding:6px var(--space-md);font-size:.75rem;color:var(--text-tertiary);text-align:center;border-top:1px solid var(--border)}.search__history[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin:4px 0 0;padding:var(--space-xs);background-color:var(--bg-surface);border:1px solid var(--border-bright);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:50}.search__history-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--space-xs) var(--space-sm)}.search__history-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-tertiary);font-weight:600}.search__history-clear[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-tertiary);font-size:.75rem;cursor:pointer;padding:2px 6px;min-height:auto;min-width:auto}.search__history-clear[_ngcontent-%COMP%]:hover{color:var(--accent-gold)}.search__history-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);width:100%;padding:8px var(--space-sm);background:none;border:none;color:var(--text-secondary);font-size:.9rem;cursor:pointer;text-align:left;border-radius:var(--radius);min-height:auto;min-width:auto}.search__history-item[_ngcontent-%COMP%]:hover{background-color:var(--bg-hover);color:var(--text-primary)}.search__history-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--text-tertiary);flex-shrink:0}@media(max-width:480px){.search__suggestions[_ngcontent-%COMP%], .search__history[_ngcontent-%COMP%]{max-height:50vh;overflow-y:auto}}"],changeDetection:0})};var z=class o{el=_(C);onKeydown(t){let e=this.el.nativeElement,i=Array.from(e.querySelectorAll('a, button, [tabindex="0"]')),r=document.activeElement,n=i.indexOf(r);if(n===-1)return;let d=null,b=this.getGridColumns(e);switch(t.key){case"ArrowRight":d=n+1<i.length?n+1:n;break;case"ArrowLeft":d=n-1>=0?n-1:n;break;case"ArrowDown":d=n+b<i.length?n+b:n;break;case"ArrowUp":d=n-b>=0?n-b:n;break;case"Home":d=0;break;case"End":d=i.length-1;break;default:return}t.preventDefault(),i[d].focus()}getGridColumns(t){let e=t.querySelector('.grid, [role="list"]');if(!e)return 1;let i=Array.from(e.children);if(i.length<2)return 1;let r=i[0].getBoundingClientRect().top;for(let n=1;n<i.length;n++)if(i[n].getBoundingClientRect().top!==r)return n;return i.length}static \u0275fac=function(e){return new(e||o)};static \u0275dir=I({type:o,selectors:[["","appKeyboardNav",""]],hostBindings:function(e,i){e&1&&E("keydown",function(n){return i.onKeydown(n)})}})};export{K as a,z as b};
