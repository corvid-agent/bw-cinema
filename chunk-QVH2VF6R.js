import{Xa as m,a as o,b as s,g as l,r as c,v as d}from"./chunk-DVNYVIZW.js";var p=class a{http=d(m);cache=new Map;async getDetail(i){let n=this.cache.get(i.id);if(n)return n;let r=s(o({},i),{overview:"",runtime:null,tagline:"",backdropUrl:null,cast:[],crew:[],tmdbRating:i.voteAverage,imdbRating:null,rottenTomatoesRating:null,metacriticRating:null,releaseDate:"",originalLanguage:"",productionCountries:[]});if(i.tmdbId)try{let e=await l(this.http.get(`https://api.themoviedb.org/3/movie/${i.tmdbId}?append_to_response=credits`));r=s(o({},r),{overview:e.overview,runtime:e.runtime,tagline:e.tagline,backdropUrl:e.backdrop_path?`https://image.tmdb.org/t/p/w1280${e.backdrop_path}`:null,releaseDate:e.release_date,originalLanguage:e.original_language,productionCountries:e.production_countries.map(t=>t.name),cast:e.credits.cast.slice(0,10).map(t=>({name:t.name,character:t.character,profileUrl:t.profile_path?`https://image.tmdb.org/t/p/w185${t.profile_path}`:null})),crew:e.credits.crew.filter(t=>["Director","Writer","Producer"].includes(t.job)).map(t=>({name:t.name,job:t.job,department:t.department}))})}catch{}if(i.imdbId)try{let e=await l(this.http.get(`https://www.omdbapi.com/?i=${i.imdbId}&apikey=${this.getOmdbKey()}`));r.imdbRating=e.imdbRating??null;let t=e.Ratings?.find(g=>g.Source==="Rotten Tomatoes");r.rottenTomatoesRating=t?.Value??null,r.metacriticRating=e.Metascore??null}catch{}return this.cache.set(i.id,r),r}getOmdbKey(){return typeof window<"u"&&window.__OMDB_KEY||""}static \u0275fac=function(n){return new(n||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{p as a};
