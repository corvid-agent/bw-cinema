import{F as d,Ma as l,a as r,b as o,r as h}from"./chunk-HADTIDD7.js";var c="bw-cinema-collection",v="bw-cinema-watch-progress",g=class n{watchlist=d([]);watched=d([]);favorites=d([]);playlists=d([]);watchProgress=d([]);watchlistIds=l(()=>new Set(this.watchlist().map(t=>t.movieId)));watchedIds=l(()=>new Set(this.watched().map(t=>t.movieId)));favoriteIds=l(()=>new Set(this.favorites()));constructor(){this.loadFromStorage(),this.loadProgress()}addToWatchlist(t){this.watchlistIds().has(t)||(this.watchlist.update(e=>[...e,{movieId:t,addedAt:Date.now()}]),this.save())}removeFromWatchlist(t){this.watchlist.update(e=>e.filter(s=>s.movieId!==t)),this.save()}markWatched(t,e=null){this.watchedIds().has(t)||(this.watched.update(s=>[...s,{movieId:t,watchedAt:Date.now(),userRating:e,notes:null,review:null,reviewedAt:null}]),this.removeFromWatchlist(t),this.removeProgress(t),this.save())}removeWatched(t){this.watched.update(e=>e.filter(s=>s.movieId!==t)),this.save()}setRating(t,e){this.watched.update(s=>s.map(i=>i.movieId===t?o(r({},i),{userRating:e}):i)),this.save()}setNote(t,e){let s=e.trim()||null;this.watched.update(i=>i.map(a=>a.movieId===t?o(r({},a),{notes:s}):a)),this.save()}getNote(t){return this.watched().find(e=>e.movieId===t)?.notes??""}setReview(t,e){let s=e.trim()||null;this.watched.update(i=>i.map(a=>a.movieId===t?o(r({},a),{review:s,reviewedAt:s?Date.now():null}):a)),this.save()}getReview(t){return this.watched().find(e=>e.movieId===t)?.review??""}toggleFavorite(t){this.favoriteIds().has(t)?this.favorites.update(e=>e.filter(s=>s!==t)):this.favorites.update(e=>[...e,t]),this.save()}isFavorite(t){return this.favoriteIds().has(t)}trackProgress(t){this.watchProgress().find(s=>s.movieId===t)?this.watchProgress.update(s=>s.map(i=>i.movieId===t?o(r({},i),{startedAt:Date.now()}):i)):this.watchProgress.update(s=>[...s,{movieId:t,startedAt:Date.now()}]),this.saveProgress()}removeProgress(t){this.watchProgress.update(e=>e.filter(s=>s.movieId!==t)),this.saveProgress()}createPlaylist(t){let e={id:crypto.randomUUID(),name:t,movieIds:[],createdAt:Date.now()};return this.playlists.update(s=>[...s,e]),this.save(),e}renamePlaylist(t,e){this.playlists.update(s=>s.map(i=>i.id===t?o(r({},i),{name:e}):i)),this.save()}deletePlaylist(t){this.playlists.update(e=>e.filter(s=>s.id!==t)),this.save()}addToPlaylist(t,e){this.playlists.update(s=>s.map(i=>i.id===t&&!i.movieIds.includes(e)?o(r({},i),{movieIds:[...i.movieIds,e]}):i)),this.save()}removeFromPlaylist(t,e){this.playlists.update(s=>s.map(i=>i.id===t?o(r({},i),{movieIds:i.movieIds.filter(a=>a!==e)}):i)),this.save()}isInWatchlist(t){return this.watchlistIds().has(t)}isWatched(t){return this.watchedIds().has(t)}getUserRating(t){return this.watched().find(e=>e.movieId===t)?.userRating??null}save(){let t={watchlist:this.watchlist(),watched:this.watched(),favorites:this.favorites(),playlists:this.playlists()};try{localStorage.setItem(c,JSON.stringify(t))}catch{}}loadFromStorage(){try{let t=localStorage.getItem(c);if(t){let e=JSON.parse(t);this.watchlist.set(e.watchlist??[]),this.watched.set((e.watched??[]).map(s=>o(r({},s),{notes:s.notes??null,review:s.review??null,reviewedAt:s.reviewedAt??null}))),this.favorites.set(e.favorites??[]),this.playlists.set(e.playlists??[])}}catch{}}saveProgress(){try{localStorage.setItem(v,JSON.stringify(this.watchProgress()))}catch{}}loadProgress(){try{let t=localStorage.getItem(v);t&&this.watchProgress.set(JSON.parse(t))}catch{}}static \u0275fac=function(e){return new(e||n)};static \u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"})};export{g as a};
