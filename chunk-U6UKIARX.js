import{F as g,Ma as c,Xa as p,a as u,b as v,g as f,r as h,v as y}from"./chunk-SA65F7OW.js";var C=class d{http=y(p);movies=g([]);meta=g(null);loading=g(!1);loaded=g(!1);error=g(null);featured=c(()=>{let e=this.movies().filter(s=>s.isStreamable),t=e.filter(s=>s.voteAverage>=7);return t.length>=12?t.sort((s,a)=>a.voteAverage-s.voteAverage).slice(0,12):e.filter(s=>s.genres.length>0).slice(0,12)});filmOfTheDay=c(()=>{let e=this.movies().filter(a=>a.isStreamable&&a.voteAverage>=6&&a.genres.length>0);if(e.length===0)return null;let t=new Date,s=t.getFullYear()*366+(t.getMonth()+1)*31+t.getDate();return e[s%e.length]});languageCounts=c(()=>{let e=new Map;for(let t of this.movies())t.language&&e.set(t.language,(e.get(t.language)??0)+1);return[...e.entries()].sort((t,s)=>s[1]-t[1]).map(([t,s])=>({name:t,count:s}))});availableLanguages=c(()=>this.languageCounts().map(e=>e.name));async load(){if(!this.loaded()){this.loading.set(!0),this.error.set(null);try{let e=await f(this.http.get("assets/data/catalog.json")),t=e.movies.map(s=>v(u({},s),{language:s.language??null}));this.movies.set(t),this.meta.set(e.meta),this.loaded.set(!0)}catch{this.error.set("Failed to load film catalog. Please check your connection and try again.")}finally{this.loading.set(!1)}}}async retry(){this.loaded.set(!1),await this.load()}search(e){let t=this.movies();if(e.query){let a=e.query.toLowerCase();t=t.filter(o=>o.title.toLowerCase().includes(a)||o.directors.some(l=>l.toLowerCase().includes(a))||o.genres.some(l=>l.toLowerCase().includes(a))||String(o.year).includes(a))}if(e.decades.length>0&&(t=t.filter(a=>e.decades.includes(Math.floor(a.year/10)*10))),e.genres.length>0&&(t=t.filter(a=>a.genres.some(o=>e.genres.includes(o)))),e.directors.length>0){let a=e.directors.map(o=>o.toLowerCase());t=t.filter(o=>o.directors.some(l=>a.includes(l.toLowerCase())))}if(e.languages.length>0){let a=new Set(e.languages);t=t.filter(o=>o.language&&a.has(o.language))}if(e.yearRange){let[a,o]=e.yearRange;t=t.filter(l=>l.year>=a&&l.year<=o)}e.streamableOnly&&(t=t.filter(a=>a.isStreamable)),e.minRating>0&&(t=t.filter(a=>a.voteAverage>=e.minRating));let s=e.sortDirection==="asc"?1:-1;return t=[...t].sort((a,o)=>{switch(e.sortBy){case"title":return s*a.title.localeCompare(o.title);case"year":return s*(a.year-o.year);case"rating":return s*(a.voteAverage-o.voteAverage)}}),t}getSimilar(e,t=8){let s=Math.floor(e.year/10)*10,a=new Set(e.genres);return this.movies().filter(o=>o.id!==e.id&&o.isStreamable).map(o=>{let l=0,n=o.genres.filter(r=>a.has(r)).length;return l+=n*3,Math.floor(o.year/10)*10===s&&(l+=2),o.directors.some(r=>e.directors.includes(r))&&(l+=4),o.voteAverage>=7&&(l+=1),{movie:o,score:l}}).filter(o=>o.score>0).sort((o,l)=>l.score-o.score||l.movie.voteAverage-o.movie.voteAverage).slice(0,t).map(o=>o.movie)}curatedCollections=c(()=>{let e=this.movies().filter(r=>r.isStreamable);if(e.length===0)return[];let t=[],s=e.filter(r=>r.genres.some(i=>i.toLowerCase().includes("noir")||i.toLowerCase()==="crime"||i.toLowerCase()==="mystery")&&r.year>=1940&&r.year<=1959).sort((r,i)=>i.voteAverage-r.voteAverage).slice(0,12);s.length>=4&&t.push({name:"Film Noir Essentials",description:"Dark crime and mystery from the golden age of noir",movies:s});let a=e.filter(r=>r.year<1930).sort((r,i)=>i.voteAverage-r.voteAverage).slice(0,12);a.length>=4&&t.push({name:"Silent Cinema Treasures",description:"Pioneering films from the silent era",movies:a});let o=e.filter(r=>r.genres.some(i=>i.toLowerCase()==="horror")).sort((r,i)=>i.voteAverage-r.voteAverage).slice(0,12);o.length>=4&&t.push({name:"Classic Horror",description:"Iconic horror films that defined the genre",movies:o});let l=e.filter(r=>r.voteAverage>=6).sort((r,i)=>i.voteAverage-r.voteAverage).slice(0,12);l.length>=4&&t.push({name:"Highest Rated",description:"The best-rated films you can watch right now",movies:l});let n=e.filter(r=>r.genres.some(i=>i.toLowerCase()==="comedy")).sort((r,i)=>i.voteAverage-r.voteAverage).slice(0,12);return n.length>=4&&t.push({name:"Classic Comedies",description:"Timeless humor from cinema's greatest comedians",movies:n}),t});getRecommendations(e,t=12){let s=this.movies().filter(n=>e.has(n.id));if(s.length<3)return[];let a=new Map,o=new Map,l=new Map;for(let n of s){for(let i of n.genres)a.set(i,(a.get(i)??0)+1);for(let i of n.directors)o.set(i,(o.get(i)??0)+1);let r=Math.floor(n.year/10)*10;l.set(r,(l.get(r)??0)+1)}return this.movies().filter(n=>!e.has(n.id)&&n.isStreamable).map(n=>{let r=0;for(let m of n.genres)r+=(a.get(m)??0)*2;for(let m of n.directors)r+=(o.get(m)??0)*3;let i=Math.floor(n.year/10)*10;return r+=l.get(i)??0,n.voteAverage>=7&&(r+=2),{movie:n,score:r}}).filter(n=>n.score>0).sort((n,r)=>r.score-n.score||r.movie.voteAverage-n.movie.voteAverage).slice(0,t).map(n=>n.movie)}static \u0275fac=function(t){return new(t||d)};static \u0275prov=h({token:d,factory:d.\u0275fac,providedIn:"root"})};export{C as a};
