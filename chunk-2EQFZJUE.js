import{a as A}from"./chunk-U6UKIARX.js";import{$ as m,A as L,Aa as B,Ba as P,F as h,J as S,N as I,Na as N,O as c,R as D,T as V,Z as x,_ as u,ba as R,ca as M,da as k,ia as a,ja as s,ka as w,la as b,ma as T,na as E,oa as p,pa as l,v as _,wa as H,x as v,y as f,ya as d,z as y,za as O}from"./chunk-SA65F7OW.js";var Y=(n,i)=>i.id;function F(n,i){n&1&&(y(),a(0,"svg",11),w(1,"rect",13),s())}function $(n,i){n&1&&(y(),a(0,"svg",12),w(1,"path",14)(2,"path",15)(3,"line",16)(4,"line",17),s())}function j(n,i){if(n&1){let e=b();a(0,"button",10),p("click",function(){v(e);let r=l();return f(r.toggleVoice())}),u(1,F,2,0,":svg:svg",11)(2,$,5,0,":svg:svg",12),s()}if(n&2){let e=l();H("search__mic--recording",e.isListening()),x("aria-label",e.isListening()?"Stop voice search":"Voice search"),c(),m(e.isListening()?1:2)}}function G(n,i){if(n&1){let e=b();a(0,"button",22),p("mousedown",function(){let r=v(e).$implicit,o=l(2);return f(o.selectHistory(r))}),y(),a(1,"svg",23),w(2,"circle",24)(3,"polyline",25),s(),d(4),s()}if(n&2){let e=i.$implicit;c(4),B(" ",e," ")}}function U(n,i){if(n&1){let e=b();a(0,"div",7)(1,"div",18)(2,"span",19),d(3,"Recent Searches"),s(),a(4,"button",20),p("mousedown",function(){v(e);let r=l();return f(r.clearHistory())}),d(5,"Clear"),s()(),M(6,G,5,1,"button",21,R),s()}if(n&2){let e=l();c(6),k(e.searchHistory())}}function J(n,i){if(n&1&&d(0),n&2){let e=l();P(" ",e.suggestions().length," suggestion",e.suggestions().length!==1?"s":""," available ")}}function X(n,i){if(n&1&&d(0),n&2){let e=l().$implicit;B(" \xB7 ",e.directors[0])}}function Q(n,i){if(n&1){let e=b();a(0,"li",28),p("mousedown",function(){let r=v(e).$implicit,o=l(2);return f(o.selectSuggestion(r))}),a(1,"span",29),d(2),s(),a(3,"span",30),d(4),u(5,X,1,1),s()()}if(n&2){let e=i.$implicit,t=i.$index,r=l(2);H("search__suggestion--active",t===r.activeIndex()),T("id","suggestion-"+t),x("aria-selected",t===r.activeIndex()),c(2),O(e.title),c(2),O(e.year),c(),m(e.directors.length>0?5:-1)}}function W(n,i){if(n&1&&(a(0,"li",27),d(1),s()),n&2){let e=l(2);c(),P(" Showing ",e.suggestions().length," of ",e.totalMatches()," matches ")}}function Z(n,i){if(n&1&&(a(0,"ul",9),M(1,Q,6,7,"li",26,Y),u(3,W,2,2,"li",27),s()),n&2){let e=l();c(),k(e.suggestions()),c(2),m(e.totalMatches()>e.suggestions().length?3:-1)}}var K=class n{searched=N();query=h("");suggestions=h([]);totalMatches=h(0);showSuggestions=h(!1);showHistory=h(!1);activeIndex=h(-1);isListening=h(!1);searchHistory=h(this.loadHistory());speechSupported=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window);static HISTORY_KEY="bw-cinema-search-history";static MAX_HISTORY=10;catalog=_(A);elRef=_(S);debounceTimer=null;recognition=null;onDocClick(i){this.elRef.nativeElement.contains(i.target)||(this.showSuggestions.set(!1),this.showHistory.set(!1))}ngOnDestroy(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.stopVoice()}onInput(i){let e=i.target.value;this.query.set(e),this.activeIndex.set(-1),this.showHistory.set(!1),this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.searched.emit(e),this.updateSuggestions(e),this.addToHistory(e)},300)}onKeydown(i){let e=this.suggestions();if(!(!this.showSuggestions()||e.length===0))switch(i.key){case"ArrowDown":i.preventDefault(),this.activeIndex.update(t=>(t+1)%e.length);break;case"ArrowUp":i.preventDefault(),this.activeIndex.update(t=>(t-1+e.length)%e.length);break;case"Enter":this.activeIndex()>=0&&(i.preventDefault(),this.selectSuggestion(e[this.activeIndex()]));break;case"Escape":this.showSuggestions.set(!1);break}}onFocus(){this.suggestions().length>0?this.showSuggestions.set(!0):this.query().length===0&&this.showHistory.set(!0)}selectSuggestion(i){this.showSuggestions.set(!1),this.showHistory.set(!1),this.query.set(i.title),this.addToHistory(i.title),this.searched.emit(i.title)}selectHistory(i){this.showHistory.set(!1),this.query.set(i),this.searched.emit(i),this.updateSuggestions(i)}clearHistory(){this.searchHistory.set([]),this.showHistory.set(!1);try{localStorage.removeItem(n.HISTORY_KEY)}catch{}}addToHistory(i){let e=i.trim();if(e.length<2)return;let t=this.searchHistory().filter(o=>o!==e),r=[e,...t].slice(0,n.MAX_HISTORY);this.searchHistory.set(r);try{localStorage.setItem(n.HISTORY_KEY,JSON.stringify(r))}catch{}}loadHistory(){try{let i=localStorage.getItem("bw-cinema-search-history");return i?JSON.parse(i):[]}catch{return[]}}toggleVoice(){this.isListening()?this.stopVoice():this.startVoice()}startVoice(){let i=window.SpeechRecognition??window.webkitSpeechRecognition;i&&(this.recognition=new i,this.recognition.lang="en-US",this.recognition.interimResults=!1,this.recognition.maxAlternatives=1,this.recognition.onresult=e=>{let t=e.results[0][0].transcript;this.query.set(t),this.searched.emit(t),this.updateSuggestions(t),this.isListening.set(!1)},this.recognition.onerror=()=>{this.isListening.set(!1)},this.recognition.onend=()=>{this.isListening.set(!1)},this.recognition.start(),this.isListening.set(!0))}stopVoice(){this.recognition&&(this.recognition.abort(),this.recognition=null),this.isListening.set(!1)}updateSuggestions(i){if(i.length<2){this.suggestions.set([]),this.totalMatches.set(0),this.showSuggestions.set(!1);return}let e=i.toLowerCase(),t=this.catalog.movies().filter(o=>o.title.toLowerCase().includes(e)||o.directors.some(g=>g.toLowerCase().includes(e)));this.totalMatches.set(t.length);let r=t.slice(0,8);this.suggestions.set(r),this.showSuggestions.set(r.length>0)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=D({type:n,selectors:[["app-search-bar"]],hostBindings:function(e,t){e&1&&E("click",function(o){return t.onDocClick(o)},I)},outputs:{searched:"searched"},decls:12,vars:7,consts:[["role","combobox","aria-haspopup","listbox",1,"search"],["for","search-input",1,"sr-only"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","aria-hidden","true",1,"search__icon"],["cx","11","cy","11","r","8"],["d","m21 21-4.35-4.35"],["id","search-input","type","search","placeholder","Search by title, director, or year...","aria-label","Search films","aria-autocomplete","list","aria-controls","search-suggestions","autocomplete","off",1,"search__input",3,"input","focus","keydown","value"],["type","button",1,"search__mic",3,"search__mic--recording"],[1,"search__history"],["aria-live","polite","aria-atomic","true",1,"sr-only"],["role","listbox","id","search-suggestions",1,"search__suggestions"],["type","button",1,"search__mic",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x","6","y","6","width","12","height","12","rx","2"],["d","M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"],["d","M19 10v2a7 7 0 0 1-14 0v-2"],["x1","12","y1","19","x2","12","y2","23"],["x1","8","y1","23","x2","16","y2","23"],[1,"search__history-header"],[1,"search__history-label"],["type","button",1,"search__history-clear",3,"mousedown"],["type","button",1,"search__history-item"],["type","button",1,"search__history-item",3,"mousedown"],["width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","12","cy","12","r","10"],["points","12 6 12 12 16 14"],["role","option",1,"search__suggestion",3,"id","search__suggestion--active"],["role","presentation",1,"search__match-count"],["role","option",1,"search__suggestion",3,"mousedown","id"],[1,"search__suggestion-title"],[1,"search__suggestion-meta"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"label",1),d(2,"Search films"),s(),y(),a(3,"svg",2),w(4,"circle",3)(5,"path",4),s(),L(),a(6,"input",5),p("input",function(o){return t.onInput(o)})("focus",function(){return t.onFocus()})("keydown",function(o){return t.onKeydown(o)}),s(),u(7,j,3,4,"button",6),u(8,U,8,0,"div",7),a(9,"div",8),u(10,J,1,2),s(),u(11,Z,4,1,"ul",9),s()),e&2&&(x("aria-expanded",t.showSuggestions()&&t.suggestions().length>0),c(6),T("value",t.query()),x("aria-activedescendant",t.activeIndex()>=0?"suggestion-"+t.activeIndex():null),c(),m(t.speechSupported?7:-1),c(),m(!t.showSuggestions()&&t.showHistory()&&t.searchHistory().length>0?8:-1),c(2),m(t.showSuggestions()&&t.suggestions().length>0?10:-1),c(),m(t.showSuggestions()&&t.suggestions().length>0?11:-1))},styles:[".search[_ngcontent-%COMP%]{position:relative;width:100%}.search__icon[_ngcontent-%COMP%]{position:absolute;left:14px;top:50%;transform:translateY(-50%);width:18px;height:18px;color:var(--text-tertiary);pointer-events:none;z-index:1}.search__input[_ngcontent-%COMP%]{width:100%;font-size:1rem;padding:var(--space-md) 52px var(--space-md) 42px;background-color:var(--bg-surface);color:var(--text-primary);border:1px solid var(--border);border-radius:var(--radius-lg)}.search__input[_ngcontent-%COMP%]:focus{border-color:var(--accent-gold);background-color:var(--bg-input)}.search__mic[_ngcontent-%COMP%]{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-tertiary);cursor:pointer;padding:6px;min-width:36px;min-height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:color .2s,background-color .2s}.search__mic[_ngcontent-%COMP%]:hover{color:var(--accent-gold);background-color:var(--accent-gold-dim)}.search__mic--recording[_ngcontent-%COMP%]{color:#e53e3e;animation:_ngcontent-%COMP%_pulse-mic 1.2s infinite}@keyframes _ngcontent-%COMP%_pulse-mic{0%,to{opacity:1}50%{opacity:.5}}.search__suggestions[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin:4px 0 0;padding:var(--space-xs) 0;list-style:none;background-color:var(--bg-surface);border:1px solid var(--border-bright);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:110;max-height:320px;overflow-y:auto}.search__suggestion[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:10px var(--space-md);cursor:pointer;transition:background-color .1s}.search__suggestion[_ngcontent-%COMP%]:hover, .search__suggestion--active[_ngcontent-%COMP%]{background-color:var(--bg-hover)}.search__suggestion--active[_ngcontent-%COMP%]{outline:2px solid var(--accent-gold);outline-offset:-2px}.search__suggestion-title[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary);font-size:.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-right:var(--space-sm)}.search__suggestion-meta[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-tertiary);white-space:nowrap;flex-shrink:0}.search__match-count[_ngcontent-%COMP%]{padding:6px var(--space-md);font-size:.75rem;color:var(--text-tertiary);text-align:center;border-top:1px solid var(--border)}.search__history[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;margin:4px 0 0;padding:var(--space-xs);background-color:var(--bg-surface);border:1px solid var(--border-bright);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:110}.search__history-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--space-xs) var(--space-sm)}.search__history-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text-tertiary);font-weight:600}.search__history-clear[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-tertiary);font-size:.75rem;cursor:pointer;padding:2px 6px;min-height:auto;min-width:auto}.search__history-clear[_ngcontent-%COMP%]:hover{color:var(--accent-gold)}.search__history-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);width:100%;padding:8px var(--space-sm);background:none;border:none;color:var(--text-secondary);font-size:.9rem;cursor:pointer;text-align:left;border-radius:var(--radius);min-height:auto;min-width:auto}.search__history-item[_ngcontent-%COMP%]:hover{background-color:var(--bg-hover);color:var(--text-primary)}.search__history-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--text-tertiary);flex-shrink:0}@media(max-width:480px){.search__suggestions[_ngcontent-%COMP%], .search__history[_ngcontent-%COMP%]{max-height:50vh;overflow-y:auto}}"],changeDetection:0})};var z=class n{el=_(S);onKeydown(i){let e=this.el.nativeElement,t=Array.from(e.querySelectorAll('a, button, [tabindex="0"]')),r=document.activeElement,o=t.indexOf(r);if(o===-1)return;let g=null,C=this.getGridColumns(e);switch(i.key){case"ArrowRight":g=o+1<t.length?o+1:o;break;case"ArrowLeft":g=o-1>=0?o-1:o;break;case"ArrowDown":g=o+C<t.length?o+C:o;break;case"ArrowUp":g=o-C>=0?o-C:o;break;case"Home":g=0;break;case"End":g=t.length-1;break;default:return}i.preventDefault(),t[g].focus()}getGridColumns(i){let e=i.querySelector('.grid, [role="list"]');if(!e)return 1;let t=Array.from(e.children);if(t.length<2)return 1;let r=t[0].getBoundingClientRect().top;for(let o=1;o<t.length;o++)if(t[o].getBoundingClientRect().top!==r)return o;return t.length}static \u0275fac=function(e){return new(e||n)};static \u0275dir=V({type:n,selectors:[["","appKeyboardNav",""]],hostBindings:function(e,t){e&1&&E("keydown",function(o){return t.onKeydown(o)})}})};export{K as a,z as b};
